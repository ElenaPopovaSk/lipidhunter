language: python

python:
- 3.6

matrix:
  include:
  - os: linux
    python: 3.6
    install:
      - wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
      - bash miniconda.sh -b -p $HOME/miniconda
      - export PATH="$HOME/miniconda/bin:$PATH"
      - hash -r
      - conda config --set always_yes yes --set changeps1 no
      - conda update -q conda
      - conda info -a
      - conda env create -f environment.yml
      - source activate test_env
      - pip install codecov
      - pip install pytest pytest-cov
    script:
    - pytest --cov=./
    after_success:
    - codecov

  - os: osx
    language: sh
    install:
      - wget https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-x86_64.sh -O miniconda.sh
      - bash miniconda.sh -b -p $HOME/miniconda
      - export PATH="$HOME/miniconda/bin:$PATH"
      - hash -r
      - conda config --set always_yes yes --set changeps1 no
      - conda update -q conda
      - conda info -a
      - conda env create -f environment.yml
      - source activate test_env
      - pip install codecov
      - pip install pytest pytest-cov
    # command to run tests
    script:
      - pytest --cov=./
    after_success:
      - codecov

  - os: windows
    language: sh
    env: PATH="/c/tools/miniconda3/:/c/tools/miniconda3/Scripts:/c/tools/miniconda3/bin:$PATH"
    before_install:
    - choco install openssl.light
    - choco install miniconda3 --params="'/AddToPath:1'"
    install:
      - hash -r
      - conda config --set always_yes yes --set changeps1 no
      - conda update -q conda
      - conda info -a
      - conda env create -f environment.yml
      - source activate test_env
      - conda list
      - echo $PATH
      - pip install codecov
      - pip install pytest pytest-cov
    # command to run tests
    script:
      - pytest --cov=./
    after_success:
      - codecov